#include <stdio.h>
#include "sys/alt_timestamp.h"
#include "sys/alt_cache.h"
#include "system.h"
#include "nios2.h"

#define HAL_PLATFORM_RESET() NIOS2_WRITE_STATUS(0); NIOS2_WRITE_IENABLE(0); ((void (*) (void)) NIOS2_RESET_ADDR) ()

void quicksort(int *A, int len);

int main (void) {
  int a[] = {-4559, -11739, 9181, 4314, -4906, 5127, -3211, 676, -2011, -12259, -5133, 8282, -7828, -9305, 12308, 13722, 12160, 8817, -8152, -3479, -13217, -4287, 7925, 7990, -5390, -11483, -11500, -13008, 9425, -13341, 1043, -2163, -14520, -10161, -12876, -6558, 11258, 10997, -1697, 11375, -3504, 6216, -8043, -3151, 29, -4843, 14378, -14719, 340, -5544, 5870, 3822, -9493, -688, 1445, -1618, 1646, -4510, -2803, -15, -6508, -527, 11640, 6952, 14957, 3626, 7787, -7029, -9677, -8018, -14291, 9067, -4857, 1022, -13610, 8895, -2993, -13228, 14553, -13593, -3035, -13541, -6692, -2066, 3280, -5065, -6343, -13088, 1363, 11287, -13980, 13381, 7545, 7428, -7353, -8875, 9146, -9771, 8227, 5351, 8676, 2738, -13768, 5228, 1766, -14960, 12810, -14556, -12384, 10846, -5366, -1820, 10886, 4074, 7419, 14978, -14525, 685, -5636, 3104, -14515, -13766, 2353, -2137, -2304, -5616, -11967, -374, -7643, 1291, 11042, -12286, -13633, 11285, 11438, -9231, -6610, 5464, -9814, 9883, -9088, -13910, 9197, 9335, -8763, -3358, 7822, 10307, -6449, 10116, -10194, 2936, 8682, 9452, 5129, 2411, 8309, -10060, 3827, -11912, 4620, -9384, -2226, 1624, -5619, 4901, -5337, 8304, -14985, 8431, 10752, -3966, 4508, 14083, 10729, 4513, -8269, -10779, 3798, -12325, 14578, -1270, -9130, 10823, -8466, 14727, 3245, 3305, 3062, -14922, 14059, 4109, 12786, -2199, -13820, -3554, -12544, -6310, -4901, -8431, -9271, -8803, -11558, -9535, 6944, -735, 14354, 9920, 5586, -4495, 5187, -4113, -3876, 1012, -1350, 13836, -2333, 1173, 8955, 9907, 7868, 12095, 13703, 10523, 1449, 7322, -8656, -11728, -11075, 14061, 4612, 651, -12404, 1445, 1083, -4051, -14314, -3199, -12503, -10848, 9055, -741, 9043, 11942, 13203, 1739, -9702, 11244, 7252, -7517, -11357, 10462, 13546, 12262, 12315, 8563, -7559, -6459, 14116, -9143, -5441, 5400, 4296, -6448, -379, -6041, 5788, -4943, 3521, -14922, 11331, -8361, 12309, -1700, 6326, -712, -13483, -2933, -9790, 6025, -5775, 10676, 5160, 7600, 11907, 11047, -5629, 10405, -8842, 12061, 12240, 2608, 6332, 13713, -2004, 3318, -12493, -12562, 650, 3328, -9830, -4805, 939, 1046, -10333, -7919, -6639, 5124, 1469, -12823, -5111, 6485, -3711, -685, -2790, -14557, -12729, -3887, 4194, -9916, 6948, 12705, -4745, -6401, -12126, -6782, -14035, -8255, -9836, 10578, 11793, 3436, -14719, -8187, -10586, -414, 8611, -4881, 10238, -11061, -10100, 3471, 4337, 1827, -2281, 4819, -5863, -5005, -10616, -5528, -9864, -13711, 5126, 608, 5279, -10708, -11160, 9534, -9131, 2958, -5367, -684, 10134, -14383, 2207, -14569, 7970, -14262, 12337, -12317, 2176, 4575, -11794, -14512, -10061, 6104, 5576, -14093, 9941, -381, -12597, 11252, 6844, 3688, 5094, 6375, -8403, 10413, -7454, -9753, -11517, -11021, -7735, -44, -11176, -4419, 2954, 362, 7470, 14018, 14771, 5290, 5706, -6822, -12697, -5604, -12860, -6446, -12852, 5835, 6349, 4255, 14278, 6649, 14312, -9125, -2431, -11467, 11697, 6096, -13972, 6147, 9902, -578, 11915, 14701, -1113, -2334, 6487, -10767, -7340, -7981, 13910, -6777, -6612, 4094, 5560, 918, -4218, -5508, 823, -12473, 6029, -352, 9917, -6138, 7043, -9424, -14760, 5636, 12461, -8664, -14826, -8471, -4353, -6373, -11324, 14696, -10537, 5948, 519, -6859, -2507, -10564, -1182, -7701, -8521, 8828, -11110, 5305, 4994, 6615, 3552, 535, 11054, 5468, -4723, -13881, 7609, -13810, -4133, -26, 185, -4203, -3534, 12212, 10524, 728, -4036, 12514, 181, 4741, 11422, -2777, 2657, -6709, -10024, -1378, -12215, 7255, -7489, -343, -14959, -2628, -6979, -2336, -7814, -11710, 8569, 10703, -6913, 9363, 6757, 12539, -10974, 11728, -8822, -10069, -4151, -6916, -2275, 11937, 10456, -3782, -1970, 9832, 10820, 13228, 14669, 271, -14528, 14754, -11854, -11746, 5864, 3138, 14494, 13034, 9103, 7463, -4317, -6915, 14316, -7827, 12491, 3723, 11465, 11612, 1041, 10902, 5874, -79, 6703, -10575, 10318, 12544, -7476, 4849, 6511, 4862, 3321, -3877, -4651, -12244, -8257, -1722, -12831, 10522, -9041, 539, 13709, -5702, 1210, -7571, 6269, 11155, -7498, -8288, -7855, -10641, -4232, -12183, 11878, -14466, -7860, 10253, -8373, 3346, -12527, 12247, 7701, 12597, 13853, 5749, -12186, 2101, 14646, -12662, 4181, -8502, -12507, 10649, -6484, 6998, 11061, 14817, -3502, 12998, 5617, -2201, -11802, -10439, 2212, -3355, -13520, -1975, -11923, -7087, 951, 14675, -5016, -1550, 4253, 7205, -13232, -8703, -5831, -10121, 8890, -13935, 189, 1345, -4518, -2021, 1464, 1156, 14175, 2996, 2532, -14114, 3112, 2211, -11995, -2768, -13787, 3746, -7211, 6926, 6923, 10540, 13112, -1188, 6719, -8480, -11811, 747, 4575, -4243, 2277, -8043, 11909, -10970, -5462, 9186, -1497, 6358, -13277, 11711, 4124, -42, -13026, -8025, -10389, 4477, 12256, 5334, 10648, -12336, -7876, -3890, 7706, -2099, 6132, 3285, 6838, 7202, -9345, 8466, -13978, 11764, 4771, -10277, -1527, -885, 1005, 9122, -12945, 6979, -11596, -10559, -12038, 11186, -12467, 7204, 13946, -992, 3547, 1501, -3646, 9634, -2807, 784, -10678, 3001, 4187, 14647, -14000, -4000, -5079, 9550, 14517, -12673, -12810, -1040, -311, -8723, 6226, -797, 2585, -8532, -9973, 120, 10913, 11363, 12964, 9892, 12441, 13715, -12251, 4878, -8768, 14083, 12439, -134, -12718, -11063, -6847, -14163, 12036, 6933, -7986, 4411, 4075, 932, -2246, -3954, -9386, -4613, 14070, -13815, -4341, -9643, -1168, -5536, 11500, -6794, 2718, 6160, 12977, -403, -12328, -13725, 11897, 12341, -6387, 7934, -14360, -1872, -7226, -2198, -13973, 14250, -12513, 474, -3151, -1374, -13385, -1594, -8339, 8646, -6358, -6990, -13872, -12555, 13213, 7037, 10507, 4231, -10400, -4580, 2832, -13845, 11658, -12240, 8326, 402, 9703, 7042, -10653, -4632, -14855, -9204, -4377, 8725, -8180, 2677, -7135, 6953, 14108, -14346, 10067, -12892, 6620, 5694, 7919, -1622, 14140, -7578, 11872, 3772, 628, -14761, 393, 8803, 2830, 3655, -6549, 2513, -1446, -10960, -12154, 9933, 5377, -6099, -12254, -11705, -12213, 1875, -1674, -6860, -9908, 14502, -14664, -10825, 14046, 8244, -3795, 6103, -8315, 5966, 13354, 4166, -11681, 12125, -3040, -3979, -1598, -1711, 8729, -11122, 2698, 11360, 10801, -12462, -6401, -8470, 6278, -13629, -13763, 1779, -12771, -6267, 8838, -10668, 8023, 10418, 9989, 770, 5053, 8222, 12304, 5036, -7135, 44, 13957, -13178, -3667, -14099, 13053, -12910, 2749, 10602, -3371, -6554, 1661, 7655, 11698, -6774, 1582, -8179, -10549, -3815, -4103, -181, 14280, 10151, 5433, 9180, 12426, -9561, 2053, -3883, -10742, -7290, -10880, 8620, -10798, 340, -1834, -4626, -12825, 4501, -5524, -7954, -13349, 2384, -8088, 9990, -14041, -2166, -6569, 3465, 14594, -4575, 11473, -10331, 10717, -10334, -4232, 10426, -6536, -14279, 12517, 4605, -1783, -3960, -76, -6104, 14335, 567, 13836, -10606, -14509, -4906, -8354, -9150, 2170, -13298, -9541, -6903, 2573, 243, 14117, -7071, -10501, -5785, -3555, 10564, 1956, -10105, 13501, 226, 2865, -2299, 4746, -7563, 5997, -8535, -6724, 1932, 14005, -8066, -2200, 13551, 9195, 5133, 987, 1301, -9113, 8708, -2144, -3407, 1046, 865, 11787, -2682, -6282, -949, 3953, 7612, -14268, 278, -9562, -11551, -7149, -1372, 5623, -6216, 10479, 5310, -4708, 14238, -1817, 2500, -2476, -11346, -8425, 12269, -6194, 10740, 6474, 14419, -7541, -7970, 803, 9688, -6720, 3690, 11256, -8802, -6023, 4127, 12219, -9024, 8609, 388, 14346, 4477, -4281, 14791, 13192, 7827, 7560, -949, -8878, 12133, 248, -13334, -6755, -9177, 11929, -5474, 4370, 14271, -10912, -7379, -2981, -10677, 6773, -6750, -4951, -14045, -9988, -12275, -11374, 1791, 12369, 10797, 7140, -11023, -6587, 11567, 576, -6643, -4114, 6333, 10886, 638, 1582, 2956, -4799, 250, 13846, -8772, 7520, 10648, 14329, -11519, -10347, 5450, 3663, -13753, 1593, 6423, -9174, 1814, -14950, -3931, -3324, 10997, -5970, -12546, -2866, -8726, 1783, -4584, -6481, -125, -1883, -5454, -10839, 12486, -799, 14889, -6263, 7177, -11793, -10499, -10545, -11281, -6403, 13869, 2375, 12167, -4617, -8114, -14353, 8992, -1469, 7117, 6390, -7349, 576, 2105, 1945, -8501, 2941, 644, 12542, 4868, 1806, -14675, 11240, 8616, -3455, -1055, -11777, -1057, 14344, 14093, 4564, -1927, -10754, 8263, 5583, 12946, 14585, 3098, -4605, 7824, -9764, -5082, -13314, 11328, -9550, 12589, -5180, 10860, 14465, -4910, -7977, -7539, -7015, 10333, 14925, 3147, 1382, -5473, 11187, 12847, 1929, -14635, 7245, -13965, -14435, -5851, 6655, -1624, -14855, 7436, -3629, 2036, 3493, 9115, 963, -1870, -9397, -12076, -13565, 12137, -12093, -4386, -6388, -8337, -14072, 2912, 6039, 1969, 11168, 14126, -5674, 12152, 10905, 607, -13675, -10523, 10791, -9884, -3757, -6603, -8333, 2092, -579, 7812, -3793, -8927, -1804, -8567, -8153, 337, -10009, -2450, 12096, 715, -178, -10180, 2389, 14554, -9935, -10109, 8641, -11295, -13702, -7637, -14679, -7102, -13805, 13397, -3569, 6792, -10479, 10802, -8158, 12545, 7422, 9840, 11645, -12617, 7267, 6486, -1877, -8615, 6629, 2608, 10043, -6912, 10090, 11149, 2903, -5952, -14652, -4208, -518, 13105, 3717, -3314, 5774, 5747, -2871, -7341, 1677, -457, 10073, -168, -1699, -7323, -8939, -7242, -14884, -2204, 9534, 10085, -9314, -11261, -9290, 9411, 13768, 5326, 11583, -12127, 13363, -213, -13738, 10566, -9469, 13623, -2455, 14030, 4729, -13596, -706, 12231, -1405, -11800, 12513, -5262, 11328, -13404, 11502, 10364, 14148, -2546, -3157, 5719, -12612, 2845, -1098, 3168, 8686, -7718, 14911, 10683, 7713, -2401, 14778, -11131, 2281, 7152, -4912, -6277, 3978, 2512, -511, 13585, -8481, -13321, -3011, 11470, -3574, 1435, 819, 2293, -12998, 4549, 13065, 13045, 1016, 9256, -14906, -14795, -11558, -13727, -14542, -11178, -2526, 2884, -9051, 10882, -3094, 6963, 6443, -703, 12103, -11662, 14974, -12953, 594, -13803, 3719, 7766, -6889, 5920, 4359, 187, -12564, 3589, 13457, -7617, 12179, -7958, 3574, 12618, 9371, 5127, -8334, 7374, -10499, 8399, 7673, 8441, 1847, -5201, -13676, -10176, 9854, 11970, 10806, 915, -1317, 12135, 1763, -11793, -7271, -2593, -11138, 8605, 3312, -6664, -5634, 9982, 7493, -10286, -12838, -5258, 4786, 8498, -1109, 1324, -7899, 14643, 5767, 3884, -1426, 4549, 8131, 8745, 6632, 1128, -12726, -4318, 6028, -1204, 14868, 9486, -13298, 4845, 9909, 11854, 7538, -3328, 6378, 11247, 12093, -7722, -12299, 1803, -10040, -8284, -8688, -10364, -14077, -14891, -9472, 7511, -2282, 8110, -8865, -13245, 7553, 13732, -9578, 11967, -8515, -13356, 3003, 14586, -2099, -7062, -4429, 78, -156, 4613, -4731, -9595, -11256, -9714, 2833, 10280, -10981, 655, -6310, 10090, -11994, -1177, 4404, -7749, -6576, 2830, -72, -13601, -14614, 11955, -6300, 13451, -3149, 11467, -180, 6576, -12020, 13505, 9340, -12442, 10277, -3832, 7231, 7933, 3818, 1558, -5916, 3042, -14315, 5560, 4656, -8125, 14656, 6068, 1708, -6593, -12715, -13086, -8838, 2688, 223, 7029, -1009, -6027, 207, -7935, 12925, 8396, -12572, -11249, -14126, -11820, -6006, 14227, 3618, -1550, 8416, 1137, -1874, -5151, 5001, 11186, 10060, -11515, -12376, 1251, 8415, 2983, 10334, 12469, -13800, 2758, 11833, 6211, -11519, 8517, 10667, 9801, -14940, 8117, -14194, -3245, 12874, -5390, 4262, -14087, 9678, -6991, 6316, 3895, 2315, 2793, 10880, -7024, -13801, 11202, -838, -9027, 13490, -10782, 2214, -6451, -11811, 319, -5, -1452, 239, -12495, 14302, 8918, -14788, -9389, 383, 11184, 13743, -5001, -10070, -14855, -11617, -4875, -8945, -2869, 11373, 4364, -9157, 11134, -3316, 7444, 7826, 5206, 6877, -2731, -7255, -8263, -1642, -420, 3461, 14666, -5324, -5744, -7781, 1101, 1753, -6731, 6902, 13239, 3488, 4984, -4644, 13607, 3889, 2617, -3004, -5322, -7652, -9261, 10925, 3279, 965, -5234, -1813, 10726, -11320, 2326, 12357, -12370, 10043, 10785, 10300, -539, 9448, -4734, 3372, 4618, -11508, -2796, 6897, -5816, -9176, -13796, 6065, -13951, 10019, 7651, 12430, 7433, -7866, 12038, 753, 1887, 11232, 5240, -10028, 1270, -9021, 9821, 1141, 6007, 8209, -8470, 3221, -12937, -6026, -7158, -4549, -3578, -3324, -10362, 3228, -14754, -11460, 13942, -7993, -3266, -8193, 1884, -6555, -12690, -5655, -3696, -4069, -4574, -5808, 2553, -4227, -3863, 1439, 14404, 10570, -13669, -6640, 3419, -1121, 10006, -12707, 3519, -2493, 8334, -4704, 1264, -4370, -322, -3441, -5731, -9785, -5286, -9977, 2268, -1193, -14704, -8155, -1252, -11448, 6649, -13570, -13357, -13433, -8944, -193, 14176, 6001, -3087, 636, 3835, -13782, 6514, 5361, -14868, -13380, -9953, -13750, 12856, -1922, -12946, 2499, 6627, 2026, -12260, -6263, -5484, -14640, -8481, 14931, 4332, -12740, -12755, 13264, -3931, -1584, 9860, 3872, -1223, -4923, 2410, -6236, -13342, 14054, 2171, -9593, 4649, 5201, -12161, -11711, -7823, -13770, 7928, -6044, -6923, 13003, 867, -9657, -12370, -1044, 6532, -3548, 8207, 13962, -14146, 1853, -14903, 11751, -11676, -1044, -276, 11961, 14851, 11649, -11287, 6791, 4667, -3996, 10973, -2526, 3445, 9580, -4454, 1149, 9608, 871, 2774, -14129, -4673, 973, 1944, 8124, -7056, 11224, 8068, 13199, -3716, -6058, 12680, -5462, 13499, 773, 4027, 10898, -8689, 2674, 7992, 2869, 11351, -10490, -7935, -10801, -3357, 4666, 6237, -2422, 13461, 5739, -8447, -3637, -5192, -6930, 5333, -10787, -10313, -8208, -9628, 682, -11408, 5868, -11961, -13970, -6051, -9394, 8604, -14661, 3801, 13117, 11237, -14329, 8849, 5315, -3025, -7536, 10097, 14094, 11401, -12444, -13990, -11136, 9956, -13025, 13164, -14027, -4920, -1346, 4963, -244, 9348, -8240, 7591, -581, 6887, 2463, 1406, 2989, -8772, -5834, 4939, 4699, 10436, 14742, -6726, 4823, 4962, -11485, -4773, -13357, -5857, 10427, -2144, -12380, 4606, -10667, 3829, 12154, 3087, -4037, 8058, 12956, 7579, -886, -10391, -4868, -6053, -13865, -539, -7389, 12661, -3976, 11801, -14301, -13035, -10360, 427, 1480, 12532, -7424, -1574, -11749, 9572, 5630, -13816, -2056, 12370, -7974, 5641, -5400, 11008, 3834, 7685, 6268, -2985, -7439, 6436, -11235, 9441, -9125, -6571, -7329, 11952, 1487, 1344, -7830, 2862, -5897, -4980, 3273, -3260, -10675, 14392, -9581, 1427, -8636, -6119};
  int n = sizeof a / sizeof a[0];

  if (alt_timestamp_start() < 0)
    {
      printf ("No timestamp device is available.\n");
    }

alt_icache_flush_all();
alt_dcache_flush_all();

alt_u32 checksum_start_time = alt_timestamp();

  quicksort(a, n);

alt_u32 checksum_end_time = alt_timestamp();
alt_u32 i = checksum_end_time - checksum_start_time;

printf("%ld\n", i);


HAL_PLATFORM_RESET();
}

void quicksort(int *A, int len) {
  if (len < 2) return;

  int pivot = A[len / 2];

  int i, j;
  for (i = 0, j = len - 1; ; i++, j--) {
    while (A[i] < pivot) i++;
    while (A[j] > pivot) j--;

    if (i >= j) break;

    int temp = A[i];
    A[i]     = A[j];
    A[j]     = temp;
  }

  quicksort(A, i);
  quicksort(A + i, len - i);
}